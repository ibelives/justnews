!function e(t,i,o){function a(n,d){if(!i[n]){if(!t[n]){var r="function"==typeof require&&require;if(!d&&r)return r(n,!0);if(s)return s(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[n]={exports:{}};t[n][0].call(u.exports,(function(e){return a(t[n][1][e]||e)}),u,u.exports,e,t,i,o)}return i[n].exports}for(var s="function"==typeof require&&require,n=0;n<o.length;n++)a(o[n]);return a}({1:[function(e,t,i){"use strict";function o(){this._page_modules={};var e=this;this.loaded=0,this.onMessage((function(t){if(t.data&&t.data.type)switch(t.data.type){case"iframe-loaded":t.data.pid&&(e.pid=t.data.pid),e.postMessage({type:"modules",preID:e.preID?e.preID:0}),e.renderModules(),e.notice("\u5f00\u59cb\u521d\u59cb\u5316\u6a21\u5757\u5de5\u5177"),e.preID=0;break;case"iframe-reload":e.iframeLoading();break;case"wpcom-tool-loaded":e.iframeLoaded();var i=e.loaded?"\u52a0\u8f7d\u5b8c\u6210":"All done! \u6b22\u8fce\u4f7f\u7528\u53ef\u89c6\u5316\u7f16\u8f91\u5668";e.notice(i,"success",2e3),e.loaded=1,jQuery(".ve-header-submit").removeClass("loading");break;case"wpcom-panel":e.editModule(t.data.module,t.data.parent);break;case"close-wpcom-panel":jQuery("#wpcom-panel").removeClass("active"),jQuery(".mod-item").trigger("mouseleave");break;case"close-module-list":jQuery(".ve-header-add, #ve-modules").removeClass("active");break;case"save-module":var o=Object.assign({},t.data.module);e._module=t.data.module,o.type="save-module",o.settings={},e.editModule(o)}})),this.init()}o.prototype={init:function(){var e=this;this.iframeLoading(),jQuery(document).on("click",".j-modal-close",(function(){jQuery("#wpcom-panel").removeClass("active")})).on("click",".ve-header-add",(function(){jQuery("#ve-modules").length&&jQuery(".ve-header-add, #ve-modules").toggleClass("active")})).on("click",".ve-header-setting",(function(){var t=jQuery("#wpcom-panel");e.module&&"page-setting"===e.module.type&&t.hasClass("active")?t.removeClass("active"):e.editModule({type:"page-setting",settings:_panel_options.settings})})).on("click",".j-modal-submit",(function(){var t=jQuery(this);if(t.hasClass("loading"))return!1;var i=t.text();t.text(t.data("loading-text")).addClass("loading").data("text",i),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();var o=jQuery("#wpcom-panel").find("form.wpcom-modal-body").serialize().replace(/\'/g,"%27").replace(/\+/g,"%20");o=e.dataFilter(o);var a="";"save-module"===e.module.type?e.saveToMyModule(o,(function(){t.removeClass("loading").text(t.data("text"))})):"page-setting"===e.module.type?(e.saveSetting(o,(function(){t.removeClass("loading").text(t.data("text"))})),a="\u6b63\u5728\u63d0\u4ea4\u9884\u89c8\u9875\u9762\u8bbe\u7f6e..."):(e.saveModule(o,(function(){t.removeClass("loading").text(t.data("text"))})),a="\u6b63\u5728\u63d0\u4ea4\u9884\u89c8\u6a21\u5757\u8bbe\u7f6e..."),a&&e.notice(a),window.onbeforeunload=function(){return"\u786e\u5b9a\u79bb\u5f00\u5f53\u524d\u9875\u9762\u5417\uff1f"}})).on("click",".ve-header-mobile",(function(){jQuery(".ve-header-pc").removeClass("active"),jQuery(this).addClass("active"),jQuery(".ve-iframe-inner").addClass("mobile"),vm.$children[0].device="mobile"})).on("click",".ve-header-pc",(function(){jQuery(".ve-header-mobile").removeClass("active"),jQuery(this).addClass("active"),jQuery(".ve-iframe-inner").removeClass("mobile"),vm.$children[0].device="pc"})).on("click",".ve-header-submit",(function(){var t=jQuery(this);if(t.hasClass("loading"))return!1;e.iframeLoading(),t.addClass("loading"),e.notice("\u6b63\u5728\u63d0\u4ea4\u66f4\u65b0\u53d1\u5e03..."),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpcom_ve_save",id:e.pid,data:JSON.stringify(e.getData(e.pid)),settings:JSON.stringify(_panel_options.settings),nonce:jQuery("#ve-nonce").val()},dataType:"json"}).then((function(i){e.iframeLoaded(),t.removeClass("loading"),window.onbeforeunload=null,e.notice(i.msg,0==i.result?"success":"error",2e3)}),(function(){e.notice("\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01","error",2e3),e.iframeLoaded(),t.removeClass("loading")}))}))},iframeLoaded:function(){var e=document.getElementsByClassName("ve-loading");e.length&&e[0].classList.remove("active")},iframeLoading:function(){var e=document.getElementsByClassName("ve-loading");e.length&&e[0].classList.add("active")},renderModules:function(){if(document.getElementById("ve-modules"))return!1;var e=document.createElement("div");e.id="ve-modules";var t=document.createElement("div");t.classList.add("mod-wrap");var i="";if(_modules)for(var o in _modules){var a=_modules[o];if(a&&a.name){a.icon=a.icon?a.icon:"gear";var s=a.icon.split(":"),n='<i class="fa fa-'+a.icon+'"></i>';s&&s[1]&&"mti"===s[0]&&(n='<i class="mod-item-icon material-icons">'+s[1]+"</i>"),i+='<div class="mod-item" data-type="'+o+'">'+n+a.name+"</div>"}}t.innerHTML=i,e.appendChild(t),document.body.appendChild(e);var d=null;jQuery(e).on("mouseenter",".mod-item",(function(){d&&clearTimeout(d);var e=jQuery(this);d=setTimeout((function(){var t=e.data("type");if(t&&void 0!==_modules[t]&&void 0!==_modules[t].thumb){var i=document.querySelector(".mod-preview");i||((i=document.createElement("div")).classList.add("mod-preview"),document.body.appendChild(i));var o=_modules[t].thumb?_modules[t].thumb:"";o=o&&!o.match(/^(http:\/\/|https:\/\/|\/\/)/i)?'<img src="'+(o="//demo.wpcom.cn/preview/options"+(_panel_options.assets_ver?_panel_options.assets_ver:"")+o)+'">':o?'<img src="'+o+'">':'<div class="mod-preview-null">\u6682\u65e0\u9884\u89c8</div>',i.innerHTML="<h3>\u6a21\u5757\u9884\u89c8</h3>"+o,i.classList.add("active")}}),300)})).on("mouseleave",".mod-item",(function(){d&&clearTimeout(d);var e=document.querySelector(".mod-preview");e&&e.classList.remove("active")}))},editModule:function(e,t){var i=jQuery("#wpcom-panel");this.module=e,this._parent=t,i.hasClass("active")?(i.removeClass("active"),setTimeout((function(){i.trigger("module.edit",e).addClass("active")}),200)):i.trigger("module.edit",e).addClass("active")},saveModule:function(e,t){if("my-module"===this.module.type){var i=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpcom_get_module",id:e.mid,mid:this.module.id},dataType:"json"}).then((function(o){if(o.data){var a=1,s={fullwidth:"\u5168\u5bbd\u6a21\u5757",container:"\u5bb9\u5668\u6a21\u5757","sidebar-layout":"\u8fb9\u680f\u5e03\u5c40\u6a21\u5757",gird:"\u6805\u683c\u6a21\u5757"};for(var n in o.data)if(i._parent&&s[o.data[n].type]){var d="\u5d4c\u5957\u9519\u8bef\uff1a\u672c\u6b21\u6dfb\u52a0\u7684\u6a21\u5757\u542b\u6709"+s[o.data[n].type]+"\uff0c\u800c\u76ee\u6807\u4f4d\u7f6e\u5904\u4e8e"+(2===i._parent?"\u6805\u683c\u6a21\u5757":"\u5176\u4ed6\u6a21\u5757\uff08\u5982\u5168\u5bbd\u3001\u6805\u683c\u6a21\u5757\uff09")+"\u5185\uff01";i.notice(d,"error",3e3),a=0,i.postMessage({type:"remove-module",module:i.module.id}),jQuery("#wpcom-panel").removeClass("active"),void 0!==t&&t();break}a&&"1"==e.type?(o.data[0].id=i.module.id,i.postMessage({type:"insert-module",modules:o.data,target:i.module.id}),setTimeout((function(){void 0!==t&&t(),setTimeout((function(){jQuery("#wpcom-panel").removeClass("active")}),200)}),300)):a&&i._saveModule(e,t)}else 0!=e.result&&i.notice("\u6a21\u5757\u83b7\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01","error",2e3)}),(function(){i.notice("\u6a21\u5757\u83b7\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01","error",2e3)}))}else this._saveModule(e,t)},_saveModule:function(e,t){var i=this.getData(this.pid),o=this;this.module.settings.modules?e.modules=this.module.settings.modules:this.module.settings.girds&&(e.girds=this.module.settings.girds),this.module=Object.assign(this.module,{settings:e});var a=this.updateModules(this.module,i);a&&this.setData(this.pid,a,(function(){o.preID=o.module.id,o.postMessage({type:"preview"}),setTimeout((function(){void 0!==t&&t(),setTimeout((function(){jQuery("#wpcom-panel").removeClass("active")}),200)}),400)}))},saveToMyModule:function(e,t){var i=0,o=this;""===e.title&&(i=1,jQuery("#wpcom_title").addClass("err").off("change.save").on("change.save",(function(){jQuery(this).removeClass("err")}))),""===e.type&&(i=1,jQuery("#wpcom_type > div").addClass("err").parent().parent().find('input[name="type"]').off("change.save").on("change.save",(function(){jQuery("#wpcom_type > div").removeClass("err")}))),i?void 0!==t&&t():(o.notice("\u6b63\u5728\u63d0\u4ea4\u4fdd\u5b58\u6211\u7684\u6a21\u5757..."),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpcom_save_module",title:e.title,desc:e.desc,module:JSON.stringify(this._module)},dataType:"json"}).then((function(i){if(i.id){var a=_modules["my-module"];if(a.options[0].mid&&(a.options[0].mid.options?a.options[0].mid.options[i.id]=i.title:a.options[0].mid.o&&(a.options[0].mid.o[i.id]=i.title)),"0"==e.type){var s=o.updateModules({type:"my-module",settings:{mid:i.id,type:0},id:o._module.id},o.getData(o.pid));s&&o.setData(o.pid,s,(function(){o.postMessage({type:"preview"})}))}}else 0!=i.result&&o.notice("\u6a21\u5757\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01","error",2e3);void 0!==t&&t(),o.notice("\u6a21\u5757\u4fdd\u5b58\u6210\u529f\uff01","success",2e3),setTimeout((function(){jQuery("#wpcom-panel").removeClass("active")}),200)}),(function(){void 0!==t&&t()})))},saveSetting:function(e,t){_panel_options.settings=e,this.postMessage({type:"preview"}),setTimeout((function(){void 0!==t&&t(),setTimeout((function(){jQuery("#wpcom-panel").removeClass("active")}),200)}),400)},setData:function(e,t,i){t="string"==typeof t?JSON.parse(t):t,this._page_modules=this._page_modules?this._page_modules:{},this._page_modules[e]=Object.assign([],t),void 0!==i&&i()},getData:function(e){return void 0===e?this._page_modules:this._page_modules[e]},dataFilter:function(e){var t={},i={},o=Object.assign([],_modules[vm.sts.type].options),a=[];o[0]&&o[0]["tab-name"]?a=o:a.push(Object.assign({},_modules[vm.sts.type].options)),e=e.split("&");for(var s=0;s<e.length;s++){var n=e[s].split("="),d=decodeURIComponent(n[0]).match(/(\S+)\[\]$/i);d&&d[1]?(t[d[1]]||(t[d[1]]=[]),t[d[1]].push(decodeURIComponent(n[1]))):t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}for(var r=0;r<a.length;r++)i=this.optionsFilter(a[r],i,t);return i},optionsFilter:function(e,t,i){for(var o in e)if("tab-name"!==o)if(e[o].type=e[o].t?e[o].t:e[o].type,"repeat"===e[o].type||"rp"===e[o].type){t[o]=[];var a=e[o].o?e[o].o:e[o].options?e[o].options:e[o].items;for(var s in a)if("wrapper"===a[s].type||"w"===a[s].type){var n=a[s].o?a[s].o:a[s].options?a[s].options:a[s].items;for(var d in n)for(var r in i){var l=r.match(/(\S+)\[(\d+)\]/i);l&&l[1]==d&&(t[o][l[2]]||(t[o][l[2]]={}),t[o][l[2]][d]=i[r])}}else for(var u in i){var c=u.match(/(\S+)\[(\d+)\]/i);c&&c[1]==s&&(t[o][c[2]]||(t[o][c[2]]={}),t[o][c[2]][s]=i[u])}}else if("wrapper"===e[o].type||"w"===e[o].type){var m=e[o].o?e[o].o:e[o].options?e[o].options:e[o].items;t=this.optionsFilter(m,t,i)}else void 0!==i[o]&&(e[o].mobile?(t[o]=void 0!==i[o+"__pc"]?i[o+"__pc"]:i[o],void 0!==i[o+"__mobile"]&&(t[o+"_mobile"]=i[o+"__mobile"])):t[o]=i[o]);return t},updateModules:function(e,t){if(t)for(var i=0;i<t.length;i++){if(t[i].id==e.id){t[i]=e;break}if(t[i]&&t[i].settings){var o="";if(t[i].settings.girds?o="girds":t[i].settings.modules&&(o="modules"),"modules"===o&&t[i].settings[o]&&(t[i].settings[o]=this.updateModules(e,Object.assign([],t[i].settings[o]))),"girds"===o&&t[i].settings[o])for(var a in t[i].settings[o])t[i].settings[o][a]=this.updateModules(e,Object.assign([],t[i].settings[o][a]))}}return t},postMessage:function(e,t){(t=void 0!==t?t:document.getElementById("ve-iframe").contentWindow).postMessage(JSON.parse(JSON.stringify(e)),"*")},onMessage:function(e,t){void 0===t&&"function"==typeof e&&(t=e,e=window),e.addEventListener("message",(function(e){if(e.origin!==window.location.origin)return!1;t&&"function"==typeof t&&t(e)}),!1)},notice:function(e,t,i){var o=jQuery("#ve-notice"),a="",s=this;switch(o.removeClass("active"),this.nTimer&&clearTimeout(this.nTimer),t){case"success":a='<i class="material-icons success">&#xe92d;</i>';break;case"error":a='<i class="material-icons error">&#xe001;</i>';break;case"loading":default:a='<svg class="ve-notice-loading-svg" viewBox="0 0 1024 1024"><path d="M512 85.333333a42.666667 42.666667 0 0 1 42.666667 42.666667v128a42.666667 42.666667 0 0 1-85.333334 0V128a42.666667 42.666667 0 0 1 42.666667-42.666667z m0 640a42.666667 42.666667 0 0 1 42.666667 42.666667v128a42.666667 42.666667 0 0 1-85.333334 0v-128a42.666667 42.666667 0 0 1 42.666667-42.666667z m426.666667-213.333333a42.666667 42.666667 0 0 1-42.666667 42.666667h-128a42.666667 42.666667 0 0 1 0-85.333334h128a42.666667 42.666667 0 0 1 42.666667 42.666667zM298.666667 512a42.666667 42.666667 0 0 1-42.666667 42.666667H128a42.666667 42.666667 0 0 1 0-85.333334h128a42.666667 42.666667 0 0 1 42.666667 42.666667z m515.029333 301.696a42.666667 42.666667 0 0 1-60.330667 0l-90.496-90.496a42.666667 42.666667 0 0 1 60.330667-60.330667l90.496 90.453334a42.666667 42.666667 0 0 1 0 60.373333zM361.130667 361.130667a42.666667 42.666667 0 0 1-60.330667 0l-90.453333-90.453334a42.666667 42.666667 0 0 1 60.330666-60.373333l90.453334 90.496a42.666667 42.666667 0 0 1 0 60.330667zM210.346667 813.696a42.666667 42.666667 0 0 1 0-60.330667l90.496-90.496a42.666667 42.666667 0 1 1 60.330666 60.330667l-90.453333 90.496a42.666667 42.666667 0 0 1-60.373333 0zM662.869333 361.130667a42.666667 42.666667 0 0 1 0-60.330667l90.453334-90.496a42.666667 42.666667 0 0 1 60.373333 60.330667L723.2 361.130667a42.666667 42.666667 0 0 1-60.330667 0z"></path></svg>'}var n='<span class="ve-notice-icon">'+a+"</span>";n+="<span>"+e+"</span>",setTimeout((function(){o.html(n).addClass("active"),i&&(s.nTimer=setTimeout((function(){o.html(n).removeClass("active")}),i))}),270)}},window.VE=new o,setTimeout((function(){VE.notice("\u5f00\u59cb\u52a0\u8f7d\u7f16\u8f91\u533a\u9875\u9762")}),300)},{}]},{},[1]);